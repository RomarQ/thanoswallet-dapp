import{nanoid as e}from"nanoid";var n,s,t;function o(){return new Promise(e=>{const n=e=>{var n,o;e.source===window&&(null===(n=e.data)||void 0===n?void 0:n.type)===t.Response&&"PONG"===(null===(o=e.data)||void 0===o?void 0:o.payload)&&s(!0)},s=s=>{e(s),window.removeEventListener("message",n),clearTimeout(o)};d({type:t.Request,payload:"PING"}),window.addEventListener("message",n);const o=setTimeout(()=>s(!1),100)})}function r(e){let n,s=!1;const t=async(r=0)=>{const a=r<5,i=await o();s!==i&&(e(i),s=i),n=setTimeout(t,i?1e4:a?250:5e3,a?r+1:r)};return t(),()=>clearTimeout(n)}async function a(e,s,t){const o=await c({type:n.PermissionRequest,network:e,appMeta:s,force:t});return u(o.type===n.PermissionResponse),{pkh:o.pkh,rpc:o.rpc}}async function i(e,s){const t=await c({type:n.OperationRequest,sourcePkh:e,opParams:s});return u(t.type===n.OperationResponse),t.opHash}function c(n){return new Promise((o,r)=>{const a=e(),i=e=>{const n=e.data;switch(!0){case e.source!==window||(null==n?void 0:n.reqId)!==a:return;case(null==n?void 0:n.type)===t.Response:o(n.payload),window.removeEventListener("message",i);break;case(null==n?void 0:n.type)===t.ErrorResponse:r(function(e){switch(e){case s.NotGranted:return new m;case s.NotFound:return new E;case s.InvalidParams:return new R;default:return new l}}(n.payload)),window.removeEventListener("message",i)}};d({type:t.Request,payload:n,reqId:a}),window.addEventListener("message",i)})}function u(e){if(!e)throw new Error("Invalid response recieved")}function d(e){window.postMessage(e,"*")}!function(e){e.PermissionRequest="PERMISSION_REQUEST",e.PermissionResponse="PERMISSION_RESPONSE",e.OperationRequest="OPERATION_REQUEST",e.OperationResponse="OPERATION_RESPONSE"}(n||(n={})),function(e){e.NotGranted="NOT_GRANTED",e.NotFound="NOT_FOUND",e.InvalidParams="INVALID_PARAMS"}(s||(s={})),function(e){e.Request="THANOS_PAGE_REQUEST",e.Response="THANOS_PAGE_RESPONSE",e.ErrorResponse="THANOS_PAGE_ERROR_RESPONSE"}(t||(t={}));class l{constructor(){this.name="ThanosWalletError",this.message="An unknown error occured. Please try again or report it"}}class p extends l{constructor(){super(...arguments),this.name="ThanosWalletNotConnected",this.message="You need to connect ThanosWallet by calling thanosWallet.connect() first"}}class m extends l{constructor(){super(...arguments),this.name="NotGrantedThanosWalletError",this.message="Permission Not Granted"}}class E extends l{constructor(){super(...arguments),this.name="NotFoundThanosWalletError",this.message="Account Not Found. Try connect again"}}class R extends l{constructor(){super(...arguments),this.name="InvalidParamsThanosWalletError",this.message="Some of the parameters you provided are invalid"}}export{R as InvalidParamsThanosWalletError,p as NotConnectedThanosWalletError,E as NotFoundThanosWalletError,m as NotGrantedThanosWalletError,s as ThanosDAppErrorType,n as ThanosDAppMessageType,t as ThanosPageMessageType,l as ThanosWalletError,o as isAvailable,r as onAvailabilityChange,i as requestOperation,a as requestPermission};
//# sourceMappingURL=index.modern.js.map
