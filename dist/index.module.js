import{nanoid as e}from"nanoid";var n,t,r;function o(e,n){e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n}!function(e){e.PermissionRequest="PERMISSION_REQUEST",e.PermissionResponse="PERMISSION_RESPONSE",e.OperationRequest="OPERATION_REQUEST",e.OperationResponse="OPERATION_RESPONSE"}(n||(n={})),function(e){e.NotGranted="NOT_GRANTED",e.NotFound="NOT_FOUND",e.InvalidParams="INVALID_PARAMS"}(t||(t={})),function(e){e.Request="THANOS_PAGE_REQUEST",e.Response="THANOS_PAGE_RESPONSE",e.ErrorResponse="THANOS_PAGE_ERROR_RESPONSE"}(r||(r={}));var s=function(e,t){try{return Promise.resolve(c({type:n.OperationRequest,sourcePkh:e,opParams:t})).then(function(e){return p(e.type===n.OperationResponse),e.opHash})}catch(e){return Promise.reject(e)}},a=function(e,t,r){try{return Promise.resolve(c({type:n.PermissionRequest,network:e,appMeta:t,force:r})).then(function(e){return p(e.type===n.PermissionResponse),{pkh:e.pkh,rpc:e.rpc}})}catch(e){return Promise.reject(e)}};function i(){return new Promise(function(e){var n=function(e){var n,o;e.source===window&&(null===(n=e.data)||void 0===n?void 0:n.type)===r.Response&&"PONG"===(null===(o=e.data)||void 0===o?void 0:o.payload)&&t(!0)},t=function(t){e(t),window.removeEventListener("message",n),clearTimeout(o)};d({type:r.Request,payload:"PING"}),window.addEventListener("message",n);var o=setTimeout(function(){return t(!1)},100)})}function u(e){var n,t=!1;return function r(o){void 0===o&&(o=0);try{var s=o<5;return Promise.resolve(i()).then(function(a){t!==a&&(e(a),t=a),n=setTimeout(r,a?1e4:s?250:5e3,s?o+1:o)})}catch(e){return Promise.reject(e)}}(),function(){return clearTimeout(n)}}function c(n){return new Promise(function(o,s){var a=e();d({type:r.Request,payload:n,reqId:a}),window.addEventListener("message",function e(n){var i=n.data;switch(!0){case n.source!==window||(null==i?void 0:i.reqId)!==a:return;case(null==i?void 0:i.type)===r.Response:o(i.payload),window.removeEventListener("message",e);break;case(null==i?void 0:i.type)===r.ErrorResponse:s(function(e){switch(e){case t.NotGranted:return new v;case t.NotFound:return new f;case t.InvalidParams:return new E;default:return new l}}(i.payload)),window.removeEventListener("message",e)}})})}function p(e){if(!e)throw new Error("Invalid response recieved")}function d(e){window.postMessage(e,"*")}var l=function(){this.name="ThanosWalletError",this.message="An unknown error occured. Please try again or report it"},m=function(e){function n(){var n;return(n=e.apply(this,arguments)||this).name="ThanosWalletNotConnected",n.message="You need to connect ThanosWallet by calling thanosWallet.connect() first",n}return o(n,e),n}(l),v=function(e){function n(){var n;return(n=e.apply(this,arguments)||this).name="NotGrantedThanosWalletError",n.message="Permission Not Granted",n}return o(n,e),n}(l),f=function(e){function n(){var n;return(n=e.apply(this,arguments)||this).name="NotFoundThanosWalletError",n.message="Account Not Found. Try connect again",n}return o(n,e),n}(l),E=function(e){function n(){var n;return(n=e.apply(this,arguments)||this).name="InvalidParamsThanosWalletError",n.message="Some of the parameters you provided are invalid",n}return o(n,e),n}(l);export{E as InvalidParamsThanosWalletError,m as NotConnectedThanosWalletError,f as NotFoundThanosWalletError,v as NotGrantedThanosWalletError,t as ThanosDAppErrorType,n as ThanosDAppMessageType,r as ThanosPageMessageType,l as ThanosWalletError,i as isAvailable,u as onAvailabilityChange,s as requestOperation,a as requestPermission};
//# sourceMappingURL=index.module.js.map
