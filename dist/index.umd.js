!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("nanoid")):"function"==typeof define&&define.amd?define(["exports","nanoid"],n):n((e=e||self).dapp={},e.nanoid)}(this,function(e,n){var o,r,t;function a(e,n){e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n}function s(){return new Promise(function(n){var o=function(n){var o,t;n.source===window&&(null===(o=n.data)||void 0===o?void 0:o.type)===e.ThanosPageMessageType.Response&&"PONG"===(null===(t=n.data)||void 0===t?void 0:t.payload)&&r(!0)},r=function(e){n(e),window.removeEventListener("message",o),clearTimeout(t)};u({type:e.ThanosPageMessageType.Request,payload:"PING"}),window.addEventListener("message",o);var t=setTimeout(function(){return r(!1)},100)})}function i(o){return new Promise(function(r,t){var a=n.nanoid();u({type:e.ThanosPageMessageType.Request,payload:o,reqId:a}),window.addEventListener("message",function n(o){var s=o.data;switch(!0){case o.source!==window||(null==s?void 0:s.reqId)!==a:return;case(null==s?void 0:s.type)===e.ThanosPageMessageType.Response:r(s.payload),window.removeEventListener("message",n);break;case(null==s?void 0:s.type)===e.ThanosPageMessageType.ErrorResponse:t(function(n){switch(n){case e.ThanosDAppErrorType.NotGranted:return new l;case e.ThanosDAppErrorType.NotFound:return new T;case e.ThanosDAppErrorType.InvalidParams:return new h;default:return new c}}(s.payload)),window.removeEventListener("message",n)}})})}function p(e){if(!e)throw new Error("Invalid response recieved")}function u(e){window.postMessage(e,"*")}(o=e.ThanosDAppMessageType||(e.ThanosDAppMessageType={})).PermissionRequest="PERMISSION_REQUEST",o.PermissionResponse="PERMISSION_RESPONSE",o.OperationRequest="OPERATION_REQUEST",o.OperationResponse="OPERATION_RESPONSE",(r=e.ThanosDAppErrorType||(e.ThanosDAppErrorType={})).NotGranted="NOT_GRANTED",r.NotFound="NOT_FOUND",r.InvalidParams="INVALID_PARAMS",(t=e.ThanosPageMessageType||(e.ThanosPageMessageType={})).Request="THANOS_PAGE_REQUEST",t.Response="THANOS_PAGE_RESPONSE",t.ErrorResponse="THANOS_PAGE_ERROR_RESPONSE";var c=function(){this.name="ThanosWalletError",this.message="An unknown error occured. Please try again or report it"},d=function(e){function n(){var n;return(n=e.apply(this,arguments)||this).name="ThanosWalletNotConnected",n.message="You need to connect ThanosWallet by calling thanosWallet.connect() first",n}return a(n,e),n}(c),l=function(e){function n(){var n;return(n=e.apply(this,arguments)||this).name="NotGrantedThanosWalletError",n.message="Permission Not Granted",n}return a(n,e),n}(c),T=function(e){function n(){var n;return(n=e.apply(this,arguments)||this).name="NotFoundThanosWalletError",n.message="Account Not Found. Try connect again",n}return a(n,e),n}(c),h=function(e){function n(){var n;return(n=e.apply(this,arguments)||this).name="InvalidParamsThanosWalletError",n.message="Some of the parameters you provided are invalid",n}return a(n,e),n}(c);e.InvalidParamsThanosWalletError=h,e.NotConnectedThanosWalletError=d,e.NotFoundThanosWalletError=T,e.NotGrantedThanosWalletError=l,e.ThanosWalletError=c,e.isAvailable=s,e.onAvailabilityChange=function(e){var n,o=!1;return function r(t){void 0===t&&(t=0);try{var a=t<5;return Promise.resolve(s()).then(function(s){o!==s&&(e(s),o=s),n=setTimeout(r,s?1e4:a?250:5e3,a?t+1:t)})}catch(e){return Promise.reject(e)}}(),function(){return clearTimeout(n)}},e.requestOperation=function(n,o){try{return Promise.resolve(i({type:e.ThanosDAppMessageType.OperationRequest,sourcePkh:n,opParams:o})).then(function(n){return p(n.type===e.ThanosDAppMessageType.OperationResponse),n.opHash})}catch(e){return Promise.reject(e)}},e.requestPermission=function(n,o,r){try{return Promise.resolve(i({type:e.ThanosDAppMessageType.PermissionRequest,network:n,appMeta:o,force:r})).then(function(n){return p(n.type===e.ThanosDAppMessageType.PermissionResponse),{pkh:n.pkh,rpc:n.rpc}})}catch(e){return Promise.reject(e)}}});
//# sourceMappingURL=index.umd.js.map
