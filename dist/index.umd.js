!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("nanoid"),require("@taquito/taquito")):"function"==typeof define&&define.amd?define(["exports","nanoid","@taquito/taquito"],r):r((e=e||self).dapp={},e.nanoid,e.taquito)}(this,function(e,r,t){var n,o,a;function s(){return(s=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function i(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,e.__proto__=r}function u(e,r){if(null==e)return{};var t,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r.indexOf(t=a[n])>=0||(o[t]=e[t]);return o}(n=e.ThanosDAppMessageType||(e.ThanosDAppMessageType={})).PermissionRequest="PERMISSION_REQUEST",n.PermissionResponse="PERMISSION_RESPONSE",n.OperationRequest="OPERATION_REQUEST",n.OperationResponse="OPERATION_RESPONSE",n.SignRequest="SIGN_REQUEST",n.SignResponse="SIGN_RESPONSE",n.BroadcastRequest="BROADCAST_REQUEST",n.BroadcastResponse="BROADCAST_RESPONSE",(o=e.ThanosDAppErrorType||(e.ThanosDAppErrorType={})).NotGranted="NOT_GRANTED",o.NotFound="NOT_FOUND",o.InvalidParams="INVALID_PARAMS",(a=e.ThanosPageMessageType||(e.ThanosPageMessageType={})).Request="THANOS_PAGE_REQUEST",a.Response="THANOS_PAGE_RESPONSE",a.ErrorResponse="THANOS_PAGE_ERROR_RESPONSE";var p=function(r){try{return Promise.resolve(T({type:e.ThanosDAppMessageType.BroadcastRequest,signedOpBytes:r})).then(function(r){return f(r.type===e.ThanosDAppMessageType.BroadcastResponse),r.opHash})}catch(e){return Promise.reject(e)}},c=function(r,t){try{return Promise.resolve(T({type:e.ThanosDAppMessageType.SignRequest,sourcePkh:r,payload:t})).then(function(r){return f(r.type===e.ThanosDAppMessageType.SignResponse),r.signature})}catch(e){return Promise.reject(e)}},l=function(r,t){try{return Promise.resolve(T({type:e.ThanosDAppMessageType.OperationRequest,sourcePkh:r,opParams:t})).then(function(r){return f(r.type===e.ThanosDAppMessageType.OperationResponse),r.opHash})}catch(e){return Promise.reject(e)}},h=function(r,t,n){try{return Promise.resolve(T({type:e.ThanosDAppMessageType.PermissionRequest,network:r,appMeta:t,force:n})).then(function(r){return f(r.type===e.ThanosDAppMessageType.PermissionResponse),{pkh:r.pkh,rpc:r.rpc}})}catch(e){return Promise.reject(e)}};function m(){return new Promise(function(r){var t=function(r){var t,o;r.source===window&&(null===(t=r.data)||void 0===t?void 0:t.type)===e.ThanosPageMessageType.Response&&"PONG"===(null===(o=r.data)||void 0===o?void 0:o.payload)&&n(!0)},n=function(e){r(e),window.removeEventListener("message",t),clearTimeout(o)};y({type:e.ThanosPageMessageType.Request,payload:"PING"}),window.addEventListener("message",t);var o=setTimeout(function(){return n(!1)},500)})}function d(e){var r,t=!1;return function n(o){void 0===o&&(o=0);try{var a=o<5;return Promise.resolve(m()).then(function(s){t!==s&&(e(s),t=s),r=setTimeout(n,s?1e4:a?0:5e3,a?o+1:o)})}catch(e){return Promise.reject(e)}}(),function(){return clearTimeout(r)}}function T(t){return new Promise(function(n,o){var a=r.nanoid();y({type:e.ThanosPageMessageType.Request,payload:t,reqId:a}),window.addEventListener("message",function r(t){var s=t.data;switch(!0){case t.source!==window||(null==s?void 0:s.reqId)!==a:return;case(null==s?void 0:s.type)===e.ThanosPageMessageType.Response:n(s.payload),window.removeEventListener("message",r);break;case(null==s?void 0:s.type)===e.ThanosPageMessageType.ErrorResponse:o(function(r){switch(!0){case r===e.ThanosDAppErrorType.NotGranted:return new v;case r===e.ThanosDAppErrorType.NotFound:return new g;case r===e.ThanosDAppErrorType.InvalidParams:return new E;case null==r?void 0:r.startsWith("__tezos__"):return new Error(r.replace("__tezos__",""));default:return new P}}(s.payload)),window.removeEventListener("message",r)}})})}function f(e){if(!e)throw new Error("Invalid response recieved")}function y(e){window.postMessage(e,"*")}var P=function(){this.name="ThanosWalletError",this.message="An unknown error occured. Please try again or report it"},v=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).name="NotGrantedThanosWalletError",r.message="Permission Not Granted",r}return i(r,e),r}(P),g=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).name="NotFoundThanosWalletError",r.message="Account Not Found. Try connect again",r}return i(r,e),r}(P),E=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).name="InvalidParamsThanosWalletError",r.message="Some of the parameters you provided are invalid",r}return i(r,e),r}(P),R=function(){function e(e){this.appName=e}var r,n=e.prototype;return n.toTezos=function(){A(this.pkh);var e=new t.TezosToolkit;return e.setProvider({wallet:this,rpc:this.rpc}),e},n.connect=function(e,r){void 0===r&&(r={forcePermission:!1});try{var t=this;return Promise.resolve(h(e,{name:t.appName},r.forcePermission)).then(function(e){var r=e.rpc;t.pkh=e.pkh,t.rpc=r})}catch(e){return Promise.reject(e)}},n.getPKH=function(){try{return A(this.pkh),Promise.resolve(this.pkh)}catch(e){return Promise.reject(e)}},n.mapTransferParamsToWalletParams=function(e){try{return Promise.resolve(t.createTransferOperation(e))}catch(e){return Promise.reject(e)}},n.mapOriginateParamsToWalletParams=function(e){try{return Promise.resolve(t.createOriginationOperation(e))}catch(e){return Promise.reject(e)}},n.mapDelegateParamsToWalletParams=function(e){try{return Promise.resolve(t.createSetDelegateOperation(e))}catch(e){return Promise.reject(e)}},n.sendOperations=function(e){try{return A(this.pkh),Promise.resolve(l(this.pkh,e.map(N)))}catch(e){return Promise.reject(e)}},n.sign=function(e){try{return A(this.pkh),Promise.resolve(c(this.pkh,e))}catch(e){return Promise.reject(e)}},n.broadcast=function(e){try{return A(this.pkh),Promise.resolve(p(e))}catch(e){return Promise.reject(e)}},(r=[{key:"connected",get:function(){return Boolean(this.pkh)}}])&&function(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(e.prototype,r),e}();R.isAvailable=m,R.onAvailabilityChange=d;var O=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).name="ThanosWalletNotConnected",r.message="You need to connect ThanosWallet by calling thanosWallet.connect() first",r}return i(r,e),r}(P);function A(e){if(!e)throw new O}function N(e){var r=u(e,["fee","gas_limit","storage_limit"]);if("transaction"===e.kind){var t=r.destination,n=r.amount,o=r.parameters;return s({},u(r,["destination","amount","parameters"]),{to:t,amount:+n,mutez:!0,parameter:o})}return r}e.InvalidParamsThanosWalletError=E,e.NotConnectedThanosWalletError=O,e.NotFoundThanosWalletError=g,e.NotGrantedThanosWalletError=v,e.ThanosWallet=R,e.ThanosWalletError=P,e.isAvailable=m,e.onAvailabilityChange=d,e.requestBroadcast=p,e.requestOperation=l,e.requestPermission=h,e.requestSign=c});
//# sourceMappingURL=index.umd.js.map
